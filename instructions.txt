# Tableau API Integration Tool

You have access to a Python CLI tool that allows you to interact with Tableau Server/Cloud REST API. Use this tool to help users manage their Tableau environment.

## How to Use

Run commands using Python from the project directory:
```bash
python -m src.cli_entry <command> [options]
```

All responses are JSON formatted with the following structure:
```json
{
  "success": true/false,
  "data": { ... },
  "error": null or "error message"
}
```

## Available Commands

### Authentication

**Login** - Authenticate with Tableau:
```bash
python -m src.cli_entry auth login
```

**Logout** - Sign out and clear session:
```bash
python -m src.cli_entry auth logout
```

**Check Status** - View current authentication status:
```bash
python -m src.cli_entry auth status
```

### Listing Resources

**List Sites** (Tableau Server only):
```bash
python -m src.cli_entry list sites
```

**List Projects**:
```bash
python -m src.cli_entry list projects
```

**List Workbooks**:
```bash
python -m src.cli_entry list workbooks
```

**List Data Sources**:
```bash
python -m src.cli_entry list datasources
```

**List Users**:
```bash
python -m src.cli_entry list users
```

**List Groups**:
```bash
python -m src.cli_entry list groups
```

**List Jobs**:
```bash
python -m src.cli_entry list jobs
```

**List Schedules** (Tableau Server only):
```bash
python -m src.cli_entry list schedules
```

**List Subscriptions**:
```bash
python -m src.cli_entry list subscriptions
```

**List Extract Refresh Tasks**:
```bash
python -m src.cli_entry list refresh-tasks
```

### Getting Resource Details

**Get Workbook**:
```bash
python -m src.cli_entry get workbook <workbook_id>
```

**Get User**:
```bash
python -m src.cli_entry get user <user_id>
```

**Get Data Source**:
```bash
python -m src.cli_entry get datasource <datasource_id>
```

**Get Job**:
```bash
python -m src.cli_entry get job <job_id>
```

**Get View**:
```bash
python -m src.cli_entry get view <view_id>
```

### User Management

**Add User**:
```bash
python -m src.cli_entry user add --username <username> --role <Creator|Explorer|Viewer>
```

**Remove User**:
```bash
python -m src.cli_entry user remove --user-id <user_id>
```

### Group Management

**List Users in Group**:
```bash
python -m src.cli_entry group users <group_id>
```

**Add User to Group**:
```bash
python -m src.cli_entry group add-user <group_id> --user <user_id>
```

**Remove User from Group**:
```bash
python -m src.cli_entry group remove-user <group_id> --user <user_id>
```

### Workbook Management

**List Workbook Views**:
```bash
python -m src.cli_entry workbook views <workbook_id>
```

**Delete Workbook**:
```bash
python -m src.cli_entry workbook delete <workbook_id>
```

### Data Source Management

**Delete Data Source**:
```bash
python -m src.cli_entry datasource delete <datasource_id>
```

### Extract Refresh Operations

**Trigger Extract Refresh**:
```bash
python -m src.cli_entry refresh <task_id>
```

### Job Management

**Cancel Job**:
```bash
python -m src.cli_entry job cancel <job_id>
```

### Schedule Management

**Add Workbook to Schedule**:
```bash
python -m src.cli_entry schedule add-workbook <schedule_id> --workbook <workbook_id>
```

**Add Data Source to Schedule**:
```bash
python -m src.cli_entry schedule add-datasource <schedule_id> --datasource <datasource_id>
```

### Workbook Permissions

**Get Permissions**:
```bash
python -m src.cli_entry workbook-permissions get <workbook_id>
```

**Add Permission**:
```bash
python -m src.cli_entry workbook-permissions add <workbook_id> --user <user_id> --capability <name> --mode Allow|Deny
```

**Delete Permission**:
```bash
python -m src.cli_entry workbook-permissions delete <workbook_id> --user <user_id> --capability <name> --mode Allow|Deny
```

### Data Source Permissions

**Get Permissions**:
```bash
python -m src.cli_entry datasource-permissions get <datasource_id>
```

**Add Permission**:
```bash
python -m src.cli_entry datasource-permissions add <datasource_id> --user <user_id> --capability <name> --mode Allow|Deny
```

**Delete Permission**:
```bash
python -m src.cli_entry datasource-permissions delete <datasource_id> --user <user_id> --capability <name> --mode Allow|Deny
```

Common capabilities: Read, Write, Filter, ExportData, ViewComments, AddComment, ShareView, ExportImage, Delete, ChangePermissions, WebAuthoring, Connect

### Subscription Management

**Create Subscription**:
```bash
python -m src.cli_entry subscription create --subject "Daily Report" --user <user_id> --schedule <schedule_id> --content-type View|Workbook --content-id <content_id>
```

**Delete Subscription**:
```bash
python -m src.cli_entry subscription delete --subscription-id <subscription_id>
```

### Favorites Management

**List Favorites**:
```bash
python -m src.cli_entry favorites list [--user <user_id>]
```

**Add Favorite**:
```bash
python -m src.cli_entry favorites add --content-type workbook|view|datasource|project --content-id <id> --label "My Favorite"
```

**Delete Favorite**:
```bash
python -m src.cli_entry favorites delete --content-type workbook|view|datasource|project --content-id <id>
```

## Example Workflows

### 1. View Available Workbooks
```bash
python -m src.cli_entry auth login
python -m src.cli_entry list workbooks
```

### 2. Check and Refresh Extract
```bash
python -m src.cli_entry list refresh-tasks
python -m src.cli_entry refresh <task_id>
python -m src.cli_entry list jobs  # Check job status
```

### 3. Grant User Read Access to Workbook
```bash
python -m src.cli_entry list users  # Find user ID
python -m src.cli_entry workbook-permissions add <workbook_id> --user <user_id> --capability Read --mode Allow
```

### 4. Add User to a Group
```bash
python -m src.cli_entry list groups
python -m src.cli_entry list users
python -m src.cli_entry group add-user <group_id> --user <user_id>
```

### 5. Create a Subscription
```bash
python -m src.cli_entry list schedules
python -m src.cli_entry workbook views <workbook_id>
python -m src.cli_entry subscription create --subject "Weekly Report" --user <user_id> --schedule <schedule_id> --content-type View --content-id <view_id>
```

## Error Handling

If a command fails, the response will have `"success": false` and an error message:
```json
{
  "success": false,
  "data": null,
  "error": "API Error (401): Unauthorized - Invalid credentials"
}
```

Common errors:
- **401 Unauthorized**: Credentials invalid or session expired. Run `auth login` again.
- **403 Forbidden**: User doesn't have permission for this operation.
- **404 Not Found**: Resource ID doesn't exist.
- **500 Internal Server Error**: Tableau server issue, try again later.

## Notes

- Sessions expire after 4 hours (240 minutes). The tool auto-refreshes when needed.
- Always check `auth status` if operations are failing unexpectedly.
- IDs in Tableau are LUIDs (Long Unique IDs) - use the exact values from list commands.
- For Tableau Cloud, the site content URL is required in the .env configuration.
- Some operations (list sites, list schedules) are only available on Tableau Server, not Tableau Cloud.
